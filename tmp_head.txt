<template>
  <div class="erp-login">
    <div class="progress-bar" :style="{ width: progress + '%' }" v-if="isVerifying"></div>
    <!-- è‡ªå®šä¹‰é¡¶éƒ¨è¿›åº¦æ¡ -->
    <el-container class="erp-login-container">
      <el-main>
        <div class="erp-login-main" ref="erpLoginMain">
          <!-- é¡µé¢å†…å®¹ï¼Œå¯ä»¥ä¿æŒç°æœ‰ç»“æ?-->
        </div>
      </el-main>
    </el-container>
  </div>
</template>

<script>
import {
  getCsrfTokenFromServer,
  getWarehouseRelatedInfo,
  shopifyAuth,
  shopifyDirectAuth,
} from '@/common/common-func'
import { dropShipper, config } from '@/common/commonconfig'

export default {
  name: 'erp-login',
  data() {
    return {
      isVerifying: false, // æ§åˆ¶è¿›åº¦æ¡æ˜¾ç¤?
      progress: 0, // è¿›åº¦æ¡çš„è¿›åº¦æ§åˆ¶
      thirdPartyParams: {
        hmac: '',
        host: '',
        session: '',
        shop: '',
        timestamp: '',
        direct: false
      },

    }
  },
  mounted() {
    // è·å–ç¬¬ä¸‰æ–¹éªŒè¯å‚æ•°å¹¶å­˜å…¥ data
    const queryParams = this.$route.query
    this.thirdPartyParams.hmac = queryParams.hmac || ''
    this.thirdPartyParams.host = queryParams.host || ''
    this.thirdPartyParams.session = queryParams.session || ''
    if (this.thirdPartyParams.session === '') {
      delete this.thirdPartyParams.session
    }
    this.thirdPartyParams.shop = queryParams.shop || ''
    this.thirdPartyParams.timestamp = queryParams.timestamp || ''
    this.thirdPartyParams.direct = queryParams.direct
    // å¦‚æœæ²¡æœ‰å¿…è¦çš„éªŒè¯å‚æ•°ï¼Œåˆ™è·³å›åˆ°loginé¡µé¢
    if (!this.thirdPartyParams.hmac || !this.thirdPartyParams.shop) {
      this.$router.push({ name: 'ds-login' })
    } else {
      // è‡ªåŠ¨å‘èµ·ç¬¬ä¸‰æ–¹éªŒè¯è¯·æ±?
      this.submitThirdPartyVerification()
    }
  },
  methods: {
    shopifyAuth,
    shopifyDirectAuth,
    getWarehouseRelatedInfo,
    getCsrfTokenFromServer,
    startProgressBar() {
      this.progress = 0
      this.isVerifying = true
      this.increaseProgress() // å¼€å§‹å¢åŠ è¿›åº?
    },
    increaseProgress() {
      if (this.progress < 90) {
        // è¿›åº¦æ¡è¾¾åˆ?0%åç­‰å¾…è¯·æ±‚å®Œæˆ?
        this.progress += 1
        setTimeout(this.increaseProgress, 100) // æ¯?00mså¢åŠ è¿›åº¦
      }
    },
    stopProgressBar() {
      this.progress = 100 // è¯·æ±‚å®Œæˆåå°†è¿›åº¦æ¡è®¾ç½®ä¸º100%
      setTimeout(() => {
